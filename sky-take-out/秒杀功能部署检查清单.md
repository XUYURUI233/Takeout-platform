# 秒杀功能部署检查清单

## 1. 数据库准备

### 1.1 执行SQL脚本
确保已执行 `sky_take_out.sql` 文件中的秒杀相关表创建语句：

- [x] `seckill_activity` - 秒杀活动表
- [x] `seckill_goods` - 秒杀商品表  
- [x] `seckill_order` - 秒杀订单表
- [x] `seckill_user_record` - 用户购买记录表
- [x] `seckill_stock_log` - 库存操作日志表

### 1.2 验证表结构
```sql
-- 检查表是否存在
SHOW TABLES LIKE 'seckill_%';

-- 检查字符集
SHOW CREATE TABLE seckill_activity;
```

## 2. 代码文件检查

### 2.1 实体类 (Entity)
- [x] `SeckillActivity.java` - 秒杀活动实体
- [x] `SeckillGoods.java` - 秒杀商品实体
- [x] `SeckillOrder.java` - 秒杀订单实体
- [x] `SeckillUserRecord.java` - 用户购买记录实体
- [x] `SeckillStockLog.java` - 库存操作日志实体

### 2.2 数据传输对象 (DTO)
- [x] `SeckillActivityDTO.java`
- [x] `SeckillActivityPageQueryDTO.java`
- [x] `SeckillGoodsDTO.java`
- [x] `SeckillOrderDTO.java`
- [x] `SeckillOrderPageQueryDTO.java`

### 2.3 视图对象 (VO)
- [x] `SeckillActivityVO.java`
- [x] `SeckillGoodsVO.java`
- [x] `SeckillOrderVO.java`
- [x] `SeckillOrderSubmitVO.java`
- [x] `SeckillEligibilityVO.java`
- [x] `SeckillStatisticsVO.java`

### 2.4 数据访问层 (Mapper)
- [x] `SeckillActivityMapper.java` + `SeckillActivityMapper.xml`
- [x] `SeckillGoodsMapper.java` + `SeckillGoodsMapper.xml`
- [x] `SeckillOrderMapper.java` + `SeckillOrderMapper.xml`
- [x] `SeckillUserRecordMapper.java`
- [x] `SeckillStockLogMapper.java`

### 2.5 业务逻辑层 (Service)
- [x] `SeckillActivityService.java` + `SeckillActivityServiceImpl.java`
- [x] `SeckillGoodsService.java` + `SeckillGoodsServiceImpl.java`
- [x] `SeckillOrderService.java` + `SeckillOrderServiceImpl.java`

### 2.6 控制器层 (Controller)
- [x] 管理端 `SeckillController.java` (admin包)
- [x] 用户端 `SeckillController.java` (user包)

### 2.7 常量和异常类
- [x] `SeckillConstant.java`
- [x] `MessageConstant.java` (已扩展)
- [x] `SeckillException.java`

### 2.8 定时任务
- [x] `SeckillTask.java`

## 3. 配置检查

### 3.1 应用配置
确认 `application.yml` 中包含以下配置：

```yaml
# 数据库配置
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/sky_take_out?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8

# MyBatis配置  
mybatis:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
```

### 3.2 定时任务启用
确认主应用类包含：
```java
@EnableScheduling // 开启任务调度
```

## 4. 功能测试

### 4.1 管理端接口测试

#### 秒杀活动管理
- [ ] `GET /admin/seckill/activity/page` - 分页查询秒杀活动
- [ ] `POST /admin/seckill/activity` - 新增秒杀活动
- [ ] `PUT /admin/seckill/activity` - 修改秒杀活动
- [ ] `DELETE /admin/seckill/activity` - 删除秒杀活动
- [ ] `GET /admin/seckill/activity/{id}` - 查询活动详情
- [ ] `POST /admin/seckill/activity/status/{status}` - 启用/停用活动

#### 秒杀商品管理
- [ ] `GET /admin/seckill/goods/available` - 查询可用商品列表
- [ ] `PUT /admin/seckill/goods` - 修改秒杀商品信息
- [ ] `DELETE /admin/seckill/goods` - 删除秒杀商品

#### 秒杀订单管理
- [ ] `GET /admin/seckill/order/page` - 分页查询秒杀订单
- [ ] `GET /admin/seckill/order/details/{id}` - 查询订单详情
- [ ] `GET /admin/seckill/statistics` - 查询统计数据

### 4.2 用户端接口测试

#### 秒杀活动展示
- [ ] `GET /user/seckill/activity/active` - 查询进行中的秒杀活动
- [ ] `GET /user/seckill/activity/{activityId}/goods` - 查询活动商品列表
- [ ] `GET /user/seckill/goods/{id}` - 查询商品详情

#### 秒杀下单流程
- [ ] `POST /user/seckill/order/submit` - 提交秒杀订单
- [ ] `PUT /user/seckill/order/payment` - 订单支付
- [ ] `PUT /user/seckill/order/cancel/{id}` - 取消订单

#### 订单查询
- [ ] `GET /user/seckill/order/list` - 查询用户订单列表
- [ ] `GET /user/seckill/order/details/{id}` - 查询订单详情
- [ ] `POST /user/seckill/order/again/{id}` - 再来一单

#### 购买资格检查
- [ ] `GET /user/seckill/check/eligibility` - 检查购买资格

## 5. 核心功能验证

### 5.1 防超卖机制测试
- [ ] 创建库存为10的秒杀商品
- [ ] 并发发起20个购买请求
- [ ] 验证只有10个请求成功，库存不会超卖

### 5.2 限购控制测试
- [ ] 设置限购数量为2
- [ ] 同一用户尝试购买3个商品
- [ ] 验证第3次购买被拒绝

### 5.3 订单超时处理测试
- [ ] 创建秒杀订单但不支付
- [ ] 等待15分钟后检查订单状态
- [ ] 验证订单自动取消且库存已释放

### 5.4 定时任务测试
- [ ] 检查定时任务日志
- [ ] 验证每分钟执行一次超时订单处理

## 6. 性能测试

### 6.1 并发测试
- [ ] 使用JMeter等工具模拟100个并发用户
- [ ] 测试秒杀下单接口响应时间
- [ ] 验证系统在高并发下的稳定性

### 6.2 数据库性能
- [ ] 检查慢查询日志
- [ ] 验证索引是否生效
- [ ] 监控数据库连接数

## 7. 监控和日志

### 7.1 日志检查
- [ ] 验证关键操作有详细日志记录
- [ ] 检查错误日志是否正常
- [ ] 确认日志编码为UTF-8

### 7.2 异常处理
- [ ] 测试各种异常场景
- [ ] 验证错误信息返回正确
- [ ] 确认异常不会导致系统崩溃

## 8. 安全检查

### 8.1 权限控制
- [ ] 验证未登录用户无法访问需要认证的接口
- [ ] 确认管理端和用户端权限隔离
- [ ] 测试JWT Token过期处理

### 8.2 数据安全
- [ ] 验证SQL注入防护
- [ ] 确认敏感数据不会泄露
- [ ] 测试参数校验是否生效

## 9. 部署准备

### 9.1 环境配置
- [ ] 确认JDK 8+环境
- [ ] 验证MySQL 5.5+版本
- [ ] 检查Redis连接配置

### 9.2 打包部署
- [ ] 执行 `mvn clean package`
- [ ] 确认jar包生成成功
- [ ] 验证配置文件正确

## 10. 上线后验证

### 10.1 功能验证
- [ ] 在生产环境测试核心流程
- [ ] 验证数据同步正确
- [ ] 确认定时任务正常运行

### 10.2 监控告警
- [ ] 设置关键指标监控
- [ ] 配置异常告警
- [ ] 验证告警机制有效

---

## 常见问题排查

### 1. 编码问题
如果出现中文乱码：
```bash
# 检查文件编码
file -bi filename.java

# 确保数据库字符集
ALTER DATABASE sky_take_out CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

### 2. 定时任务不执行
检查主应用类是否包含 `@EnableScheduling` 注解

### 3. 乐观锁不生效
验证SQL语句中的version字段条件是否正确

### 4. 接口404错误
确认Controller类的包路径在主应用类的扫描范围内

---

**部署完成标志**: 所有检查项都通过 ?，系统可以正常提供秒杀服务


