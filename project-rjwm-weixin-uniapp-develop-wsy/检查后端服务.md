# 后端服务检查指南

## 问题诊断
当前小程序遇到404错误，说明网络连接正常，但API端点不存在。这通常是因为：
1. 后端服务没有启动
2. 端口配置不正确
3. 内网穿透配置有问题

## 检查步骤

### 1. 检查后端服务是否启动

#### 方法1: 检查本地服务
```bash
# 在浏览器中访问
http://localhost:8072

# 或者测试API端点
http://localhost:8072/user/shop/status
```

#### 方法2: 检查进程
```bash
# Windows命令提示符
netstat -ano | findstr :8072

# 或者使用任务管理器查看Java进程
```

### 2. 启动后端服务

如果后端服务没有启动，请按以下步骤启动：

#### 步骤1: 进入后端项目目录
```bash
cd sky-take-out/sky-server
```

#### 步骤2: 启动服务
```bash
# 使用Maven启动
mvn spring-boot:run

# 或者先编译再运行
mvn clean package
java -jar target/sky-server-1.0-SNAPSHOT.jar
```

#### 步骤3: 检查启动日志
确保看到类似以下信息：
```
Started SkyApplication in X.XXX seconds
```

### 3. 检查内网穿透配置

如果使用cpolar进行内网穿透：

#### 检查cpolar配置
```bash
# 查看cpolar状态
cpolar status

# 重新配置端口映射
cpolar http 8072
```

#### 验证穿透地址
在浏览器中访问：
```
http://2ae29966.r10.cpolar.top:8072/user/shop/status
```

### 4. 测试API端点

#### 测试店铺状态接口
```bash
curl -X GET "http://localhost:8072/user/shop/status"
```

#### 测试用户登录接口
```bash
curl -X POST "http://localhost:8072/user/user/login" \
  -H "Content-Type: application/json" \
  -d '{"code":"test_code"}'
```

### 5. 常见问题解决

#### 问题1: 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr :8072

# 杀死占用进程
taskkill /PID <进程ID> /F
```

#### 问题2: 数据库连接失败
检查 `application-dev.yml` 中的数据库配置：
```yaml
sky:
  datasource:
    host: localhost
    port: 3306
    database: sky_take_out
    username: root
    password: 123456
```

#### 问题3: Redis连接失败
检查Redis配置：
```yaml
sky:
  redis:
    host: localhost
    port: 6379
    database: 10
    password: ""
```

### 6. 小程序配置更新

根据后端服务状态，更新 `utils/env.js`：

#### 如果后端在本地运行：
```javascript
export const baseUrl = 'http://localhost:8072'
```

#### 如果使用内网穿透：
```javascript
export const baseUrl = 'http://2ae29966.r10.cpolar.top:8072'
```

#### 如果使用其他测试环境：
```javascript
export const baseUrl = 'http://reggie-dev.itheima.net'
```

### 7. 验证修复

1. 重新编译小程序
2. 查看控制台日志
3. 确认请求返回正确的JSON响应而不是404页面

## 联系支持

如果问题仍然存在，请提供：
1. 后端服务启动日志
2. 网络请求的完整错误信息
3. 当前使用的API地址
4. 内网穿透配置信息
