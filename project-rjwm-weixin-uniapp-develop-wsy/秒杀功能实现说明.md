# 微信小程序秒杀功能实现说明

## 功能概述

本项目为苍穹外卖微信小程序添加了完整的秒杀功能，包括秒杀活动展示、商品详情、订单确认和支付流程。

## 功能特性

### 1. 秒杀横幅组件
- **位置**: 首页店铺详情和菜品栏目中间
- **样式**: 宽度100%视口，高度为店铺详情高度的四分之三
- **功能**: 
  - 5秒自动切换轮播
  - 首位无缝循环
  - 禁用原生滚动条
  - 实时倒计时显示
  - 点击跳转到活动详情

### 2. 秒杀活动详情页面
- **功能**:
  - 显示活动基本信息（名称、描述、时间）
  - 实时倒计时
  - 秒杀商品列表
  - 库存进度条
  - 购买限制提示
  - 根据活动时间控制购买按钮状态

### 3. 秒杀商品详情页面
- **功能**:
  - 商品详细信息展示
  - 价格对比（原价vs秒杀价）
  - 折扣标签
  - 购买数量选择
  - 库存和限购信息
  - 活动倒计时
  - 购买资格检查

### 4. 秒杀订单页面
- **功能**:
  - 收货地址选择
  - 商品信息确认
  - 15分钟支付倒计时
  - 订单金额计算
  - 备注填写
  - 取消订单功能
  - 立即支付功能

### 5. 支付成功页面
- **功能**:
  - 区分普通订单和秒杀订单
  - 不同的成功提示文案
  - 订单号显示（秒杀订单）
  - 预计送达时间（普通订单）

## 技术实现

### API接口
```javascript
// 获取当前进行中的秒杀活动
getActiveSeckillActivities()

// 根据活动ID获取秒杀商品列表
getSeckillGoodsByActivityId(activityId)

// 获取秒杀商品详情
getSeckillGoodsDetail(goodsId)

// 提交秒杀订单
submitSeckillOrder(params)

// 秒杀订单支付
paySeckillOrder(params)

// 取消秒杀订单
cancelSeckillOrder(orderId)

// 检查用户购买资格
checkSeckillEligibility(params)
```

### 组件结构
```
components/
└── seckill-banner/
    └── seckill-banner.vue          # 秒杀横幅组件

pages/
└── seckill/
    ├── activity-detail/
    │   └── activity-detail.vue     # 活动详情页
    ├── goods-detail/
    │   └── goods-detail.vue        # 商品详情页
    └── order/
        └── order.vue               # 订单确认页
```

### 核心功能实现

#### 1. 倒计时功能
```javascript
// 计算倒计时
calculateCountdown(endTime) {
  const now = new Date().getTime()
  const end = new Date(endTime).getTime()
  const diff = end - now

  if (diff <= 0) return null

  const hours = Math.floor(diff / (1000 * 60 * 60))
  const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))
  const seconds = Math.floor((diff % (1000 * 60)) / 1000)

  return { hours, minutes, seconds }
}
```

#### 2. 轮播组件
```vue
<swiper
  :autoplay="true"
  :interval="5000"
  :circular="true"
  indicator-dots="true"
>
  <swiper-item v-for="activity in seckillActivities" :key="activity.id">
    <!-- 轮播内容 -->
  </swiper-item>
</swiper>
```

#### 3. 状态控制
```javascript
// 判断是否可以购买
canPurchase() {
  const now = new Date().getTime()
  const startTime = new Date(this.activityInfo.startTime).getTime()
  const endTime = new Date(this.activityInfo.endTime).getTime()
  
  return now >= startTime && 
         now <= endTime && 
         this.goodsInfo.availableStock > 0 && 
         (this.goodsInfo.userPurchased || 0) < this.goodsInfo.limitCount
}
```

## 页面路由配置

```json
{
  "path": "pages/seckill/activity-detail/activity-detail",
  "style": {
    "navigationStyle": "custom",
    "navigationBarTitleText": "秒杀活动"
  }
},
{
  "path": "pages/seckill/goods-detail/goods-detail",
  "style": {
    "navigationStyle": "custom",
    "navigationBarTitleText": "秒杀商品"
  }
},
{
  "path": "pages/seckill/order/order",
  "style": {
    "navigationStyle": "custom",
    "navigationBarTitleText": "确认订单"
  }
}
```

## 样式特色

### 1. 渐变背景
```scss
background: linear-gradient(135deg, #ff6b35, #ff8a50);
```

### 2. 倒计时样式
```scss
.time-block {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 8rpx;
  padding: 12rpx 16rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
}
```

### 3. 进度条动画
```scss
.progress-fill {
  height: 100%;
  background: #ff6b35;
  transition: width 0.3s ease;
}
```

## 数据流程

1. **首页加载** → 秒杀横幅组件获取活动数据 → 显示轮播和倒计时
2. **点击横幅** → 跳转活动详情 → 显示商品列表
3. **选择商品** → 跳转商品详情 → 选择数量
4. **立即购买** → 跳转订单确认 → 选择地址和支付
5. **支付成功** → 跳转成功页面 → 显示秒杀成功信息

## 错误处理

- API请求失败时使用模拟数据
- 网络异常时显示友好提示
- 支付超时自动取消订单
- 库存不足时禁用购买按钮

## 性能优化

- 组件懒加载
- 图片预加载
- 倒计时防抖处理
- 内存泄漏防护（清理定时器）

## 兼容性

- 支持微信小程序
- 响应式设计适配不同屏幕
- 兼容iOS和Android
- 支持暗色模式

## 部署注意事项

1. 确保后端API接口已部署
2. 配置正确的域名白名单
3. 上传必要的静态资源图片
4. 测试支付功能的完整流程
5. 验证倒计时的准确性

## 后续扩展

1. 添加秒杀预告功能
2. 实现秒杀提醒功能
3. 添加分享功能
4. 支持多规格商品秒杀
5. 添加秒杀统计和分析

