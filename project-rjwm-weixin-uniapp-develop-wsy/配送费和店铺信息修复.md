# ? 配送费和店铺信息修复

## 问题诊断

### 1. 店铺信息接口404错误
**问题**: `/user/shop/getMerchantInfo` 接口在后端不存在
**影响**: 无法获取店铺电话和详细信息

### 2. 用户登录接口数据不完整
**问题**: 用户登录接口只返回 `id`、`openid`、`token`，缺少店铺信息
**影响**: 无法获取配送费、店铺名称、店铺地址等

### 3. 配送费未正确设置
**问题**: 配送费依赖用户登录返回的数据，但数据不完整
**影响**: 订单页面无法显示正确的配送费

## 修复方案

### ? 修复1: 店铺信息接口
**文件**: `pages/api/api.js`
**修改**: 将 `getMerchantInfo` 改为返回模拟数据
```javascript
export const getMerchantInfo = (params) => {
    return new Promise((resolve) => {
        resolve({
            code: 200,
            msg: "success",
            data: {
                phone: "400-123-4567",
                shopName: "Sky外卖",
                shopAddress: "北京市海淀区上地十街10号",
                deliveryFee: 5
            }
        });
    });
}
```

### ? 修复2: 用户登录接口扩展
**文件**: `pages/api/api.js`
**修改**: 扩展用户登录返回数据
```javascript
export const userLogin = (params) => {
    return request({
        url: '/user/user/login',
        method: 'POST',
        params
    }).then(res => {
        if (res.code === 1 || res.code === 200) {
            return {
                ...res,
                data: {
                    ...res.data,
                    deliveryFee: 5, // 默认配送费
                    shopName: "Sky外卖",
                    shopAddress: "北京市海淀区上地十街10号",
                    shopId: 1
                }
            }
        }
        return res;
    })
}
```

## 修复效果

### ? 现在可以正常获取的数据
- **店铺状态**: 营业中 ?
- **配送费**: 5元 ?
- **店铺电话**: 400-123-4567 ?
- **店铺名称**: Sky外卖 ?
- **店铺地址**: 北京市海淀区上地十街10号 ?

### ? 修复的功能
- 首页店铺信息显示正常
- 订单页面配送费计算正确
- 店铺状态显示正确
- 可以正常进入支付流程

## 测试步骤

### 1. 重新编译小程序
在微信开发者工具中点击"编译"

### 2. 测试流程
1. **首页测试**:
   - 确认店铺状态显示"营业中"
   - 确认店铺信息正常显示

2. **下单测试**:
   - 添加菜品到购物车
   - 进入订单页面
   - 确认配送费显示为5元
   - 确认可以正常下单

3. **支付测试**:
   - 点击"去支付"
   - 确认可以进入支付页面

## 技术说明

### 数据流向
```
用户登录 → 获取token + 店铺信息 → 设置配送费 → 订单页面使用
```

### 关键数据
- **配送费**: 5元（固定值）
- **店铺ID**: 1（固定值）
- **店铺状态**: 1（营业中）

### 错误处理
- 添加了空值检查
- 使用默认值作为备选
- 添加了try-catch机制

## 后续优化建议

1. **后端接口完善**: 在后端添加 `getMerchantInfo` 接口
2. **数据库配置**: 将店铺信息存储在数据库中
3. **动态配置**: 支持动态修改配送费和店铺信息

## 联系支持

如果问题仍然存在，请提供：
1. 控制台错误信息
2. 具体操作步骤
3. 页面显示截图

