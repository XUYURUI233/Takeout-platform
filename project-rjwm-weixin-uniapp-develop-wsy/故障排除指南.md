# 微信小程序网络错误故障排除指南

## 问题描述
小程序启动时出现 `net::ERR_NAME_NOT_RESOLVED` 错误，无法连接到API服务器。

## 可能的原因和解决方案

### 1. 域名解析问题
**症状**: `net::ERR_NAME_NOT_RESOLVED`
**原因**: 无法解析域名到IP地址

**解决方案**:
- 检查网络连接是否正常
- 尝试切换不同的API地址
- 在 `utils/env.js` 中修改 `baseUrl` 配置

### 2. API服务器配置

#### 当前配置的API地址选项:
```javascript
// 选项1: cpolar内网穿透 (当前使用)
export const baseUrl = 'http://2ae29966.r10.cpolar.top'

// 选项2: itheima测试环境
export const baseUrl = 'http://reggie-dev.itheima.net'

// 选项3: 本地开发环境
export const baseUrl = 'http://172.16.43.24:8080'

// 选项4: itheima线上环境
export const baseUrl = 'https://registakeaway.itheima.net'
```

### 3. 微信开发者工具设置

#### 开发环境设置:
1. 打开微信开发者工具
2. 点击右上角"详情"
3. 在"本地设置"中勾选:
   - ? 不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书
   - ? 开启调试模式

#### 真机调试设置:
1. 确保手机和电脑在同一网络
2. 在开发者工具中点击"预览"
3. 使用微信扫码打开小程序

### 4. 网络环境检查

#### 检查步骤:
1. **测试网络连接**
   ```bash
   # 在浏览器中访问API地址
   http://2ae29966.r10.cpolar.top
   ```

2. **检查DNS解析**
   ```bash
   # Windows命令提示符
   nslookup 2ae29966.r10.cpolar.top
   
   # 或使用ping命令
   ping 2ae29966.r10.cpolar.top
   ```

3. **检查防火墙设置**
   - 确保防火墙没有阻止小程序网络请求
   - 检查杀毒软件是否拦截了网络连接

### 5. 代码调试

#### 添加网络请求日志:
在 `utils/request.js` 中添加调试信息:

```javascript
export function request({url='', params={}, method='GET'}) {
    console.log('请求URL:', baseUrl + url)
    console.log('请求参数:', params)
    console.log('请求方法:', method)
    
    // ... 现有代码 ...
    
    uni.request({
        url: baseUrl+url, 
        data: params,
        header: header,
        method: method,
        success: (res) => {
            console.log('请求成功:', res)
            // ... 现有代码 ...
        },
        fail: (err) => {
            console.error('请求失败:', err)
            // ... 现有代码 ...
        }
    });
}
```

### 6. 常见解决方案

#### 方案1: 切换API地址
如果当前API地址无法访问，尝试切换到其他可用的地址:

1. 编辑 `utils/env.js`
2. 注释掉当前的 `baseUrl`
3. 取消注释其他可用的地址
4. 重新编译小程序

#### 方案2: 使用本地服务器
如果使用本地开发:
1. 确保后端服务正在运行
2. 使用 `http://localhost:8080` 或 `http://127.0.0.1:8080`
3. 在开发者工具中勾选"不校验合法域名"

#### 方案3: 使用内网穿透
如果需要在真机上测试:
1. 使用ngrok、cpolar等内网穿透工具
2. 将本地服务暴露到公网
3. 使用生成的公网地址作为 `baseUrl`

### 7. 错误代码对照表

| 错误代码 | 含义 | 解决方案 |
|---------|------|----------|
| `net::ERR_NAME_NOT_RESOLVED` | 域名解析失败 | 检查域名是否正确，网络是否正常 |
| `net::ERR_CONNECTION_REFUSED` | 连接被拒绝 | 检查服务器是否启动，端口是否正确 |
| `net::ERR_TIMED_OUT` | 连接超时 | 检查网络速度，服务器响应时间 |
| `net::ERR_CERT_AUTHORITY_INVALID` | 证书无效 | 使用http协议或配置正确的SSL证书 |

### 8. 联系支持

如果以上方案都无法解决问题，请提供以下信息:
1. 错误截图
2. 网络环境描述
3. 使用的API地址
4. 微信开发者工具版本
5. 小程序版本

## 预防措施

1. **定期检查API地址可用性**
2. **配置多个备用API地址**
3. **在开发环境中使用本地服务器**
4. **保持网络环境稳定**
5. **定期更新微信开发者工具**
