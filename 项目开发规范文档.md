# 苍穹外卖项目开发规范文档

## 目录
- [1. 项目概述](#1-项目概述)
- [2. 技术栈总览](#2-技术栈总览)
- [3. 后端开发规范](#3-后端开发规范)
- [4. 前端开发规范](#4-前端开发规范)
- [5. 数据库设计规范](#5-数据库设计规范)
- [6. 编码规范](#6-编码规范)
- [7. 接口规范](#7-接口规范)
- [8. 版本控制规范](#8-版本控制规范)

## 1. 项目概述

本项目是一个完整的外卖系统，包含：
- **后端服务**：Spring Boot 2.7.3 + MyBatis + MySQL
- **管理后台**：Vue 2.6.10 + TypeScript + Element UI
- **用户端**：UniApp 微信小程序

## 2. 技术栈总览

### 2.1 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Spring Boot | 2.7.3 | 主框架 |
| Java | 8 | 开发语言 |
| MyBatis | 2.2.0 | ORM框架 |
| MySQL | 5.5.36+ | 数据库 |
| Redis | - | 缓存 |
| Druid | 1.2.1 | 数据库连接池 |
| PageHelper | 1.3.0 | 分页插件 |
| Knife4j | 3.0.2 | API文档 |
| FastJSON | 1.2.76 | JSON处理 |
| Lombok | 1.18.20 | 代码简化 |
| JWT | 0.9.1 | 认证 |
| Aliyun OSS | 3.10.2 | 文件存储 |
| Apache POI | 3.16 | Excel处理 |
| AspectJ | 1.9.4 | AOP |

### 2.2 前端技术栈

#### 管理后台 (Vue TypeScript)
| 技术 | 版本 | 说明 |
|------|------|------|
| Vue | 2.6.10 | 主框架 |
| TypeScript | 3.6.2 | 开发语言 |
| Element UI | 2.12.0 | UI组件库 |
| Axios | 0.19.0 | HTTP客户端 |
| Vue Router | 3.1.2 | 路由管理 |
| Vuex | 3.1.1 | 状态管理 |
| ECharts | 5.3.2 | 图表库 |
| Sass | 1.22.10 | CSS预处理器 |

#### 用户端 (UniApp)
| 技术 | 版本 | 说明 |
|------|------|------|
| UniApp | - | 跨平台框架 |
| Vue | 2.x | 主框架 |
| JavaScript | ES6+ | 开发语言 |
| 微信小程序 | - | 目标平台 |

## 3. 后端开发规范

### 3.1 项目结构
```
sky-take-out/
├── sky-common/          # 公共模块
├── sky-pojo/           # 实体类模块
└── sky-server/         # 服务模块
    ├── controller/     # 控制器层
    │   ├── admin/     # 管理端接口
    │   └── user/      # 用户端接口
    ├── service/       # 服务层
    ├── mapper/        # 数据访问层
    ├── config/        # 配置类
    └── interceptor/   # 拦截器
```

### 3.2 包命名规范
- 基础包名：`com.sky`
- 控制器：`com.sky.controller.admin` / `com.sky.controller.user`
- 服务层：`com.sky.service` / `com.sky.service.impl`
- 数据访问：`com.sky.mapper`
- 实体类：`com.sky.entity`
- DTO：`com.sky.dto`
- VO：`com.sky.vo`

### 3.3 类命名规范
- **Controller类**：以`Controller`结尾，如`DishController`
- **Service接口**：以`Service`结尾，如`DishService`
- **Service实现**：以`ServiceImpl`结尾，如`DishServiceImpl`
- **Mapper接口**：以`Mapper`结尾，如`DishMapper`
- **实体类**：使用名词，如`Dish`、`Employee`
- **DTO类**：以`DTO`结尾，如`DishDTO`
- **VO类**：以`VO`结尾，如`DishVO`

### 3.4 注解使用规范

#### Controller层
```java
@RestController
@RequestMapping("/admin/dish")
@Api(tags = "菜品相关接口")
@Slf4j
public class DishController {
    
    @Autowired
    private DishService dishService;
    
    @PostMapping
    @ApiOperation("新增菜品")
    public Result save(@RequestBody DishDTO dishDTO) {
        log.info("新增菜品：{}", dishDTO);
        dishService.saveWithFlavor(dishDTO);
        return Result.success();
    }
}
```

#### 实体类
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class Dish implements Serializable {
    private static final long serialVersionUID = 1L;
    
    private Long id;
    private String name;
    // 使用BigDecimal处理金额
    private BigDecimal price;
    // 使用LocalDateTime处理时间
    private LocalDateTime createTime;
}
```

#### DTO类
```java
@Data
public class DishDTO implements Serializable {
    private Long id;
    private String name;
    // JSON时间格式化
    @JsonFormat(shape = JsonFormat.Shape.STRING, pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime estimatedDeliveryTime;
}
```

### 3.5 配置规范

#### 应用配置 (application.yml)
```yaml
server:
  port: 8072

spring:
  profiles:
    active: dev
  datasource:
    druid:
      url: jdbc:mysql://localhost:3306/sky_take_out?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8
      
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.sky.entity
  configuration:
    map-underscore-to-camel-case: true
```

### 3.6 编码规范
- **字符编码**：统一使用UTF-8编码
- **日志记录**：使用@Slf4j注解，记录关键操作
- **异常处理**：统一异常处理，返回标准Result格式
- **数据校验**：使用@Valid注解进行参数校验
- **事务管理**：使用@Transactional注解管理事务

## 4. 前端开发规范

### 4.1 Vue TypeScript 管理后台

#### 项目结构
```
src/
├── api/           # API接口
├── assets/        # 静态资源
├── components/    # 公共组件
├── layout/        # 布局组件
├── store/         # Vuex状态管理
├── styles/        # 样式文件
├── utils/         # 工具函数
└── views/         # 页面组件
```

#### API调用规范
```typescript
// api/category.ts
import request from '@/utils/request';

export const getCategoryPage = (params: any) => {
  return request({
    url: '/admin/category/page',
    method: 'get',
    params
  });
};

export const addCategory = (params: any) => {
  return request({
    url: '/admin/category',
    method: 'post',
    data: { ...params }
  });
};
```

#### HTTP请求配置
```typescript
// utils/request.ts
const service = axios.create({
  baseURL: '/api',
  timeout: 600000
});

// 请求拦截器
service.interceptors.request.use(
  (config: any) => {
    if (UserModule.token) {
      config.headers['token'] = UserModule.token;
    }
    return config;
  }
);
```

### 4.2 UniApp 微信小程序

#### 项目结构
```
project-rjwm-weixin-uniapp-develop-wsy/
├── components/    # 组件
├── pages/         # 页面
│   ├── api/      # API接口
│   └── common/   # 公共模块
├── static/        # 静态资源
├── store/         # 状态管理
├── styles/        # 样式
└── utils/         # 工具函数
```

#### API调用规范
```javascript
// pages/api/api.js
import { request } from "../../utils/request.js";

// 用户登录
export const userLogin = (params) => {
  return request({
    url: '/user/user/login',
    method: 'POST',
    params
  });
};

// 获取菜品列表
export const getDishList = (params) => {
  return request({
    url: `/user/dish/dishPageList/${params.categoryId}/${params.type}/${params.page}/${params.pageSize}`,
    method: 'GET',
    params
  });
};
```

#### HTTP请求配置
```javascript
// utils/request.js
export function request({url='', params={}, method='GET'}) {
  const header = {
    'Accept': 'application/json',
    'Content-Type': 'application/json',
    'authentication': store.state.token
  };
  
  return new Promise((resolve, reject) => {
    uni.request({
      url: baseUrl + url,
      data: params,
      header: header,
      method: method,
      success: (res) => {
        if (res.data.code == 200 || res.data.code === 1) {
          resolve(res.data);
        } else {
          reject(res.data);
        }
      },
      fail: (err) => {
        reject(err);
      }
    });
  });
}
```

## 5. 数据库设计规范

### 5.1 表命名规范
- 表名使用小写字母，单词间用下划线分隔
- 表名具有描述性，如：`address_book`、`order_detail`

### 5.2 字段命名规范
- 字段名使用小写字母，单词间用下划线分隔
- 主键统一命名为`id`
- 外键以`_id`结尾，如：`user_id`、`category_id`
- 时间字段以`_time`结尾，如：`create_time`、`update_time`
- 状态字段使用`status`
- 金额字段使用`DECIMAL(10,2)`类型

### 5.3 字段设计规范
```sql
-- 示例表结构
CREATE TABLE `dish` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `name` varchar(32) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL COMMENT '菜品名称',
  `category_id` bigint(20) NOT NULL COMMENT '菜品分类id',
  `price` decimal(10, 2) NULL DEFAULT NULL COMMENT '菜品价格',
  `image` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL COMMENT '图片',
  `description` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL COMMENT '描述信息',
  `status` int(11) NULL DEFAULT 1 COMMENT '0 停售 1 起售',
  `create_time` datetime NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` datetime NULL DEFAULT NULL COMMENT '更新时间',
  `create_user` bigint(20) NULL DEFAULT NULL COMMENT '创建人',
  `update_user` bigint(20) NULL DEFAULT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `idx_dish_name`(`name`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_bin COMMENT = '菜品';
```

### 5.4 字符集规范
- **数据库字符集**：utf8mb4
- **排序规则**：utf8mb4_general_ci
- **连接字符集**：UTF-8

## 6. 编码规范

### 6.1 通用编码规范
- **字符编码**：所有代码文件统一使用UTF-8编码
- **缩进**：使用2个空格进行缩进（前端）或4个空格（后端）
- **换行符**：统一使用LF（\n）
- **文件编码**：生成代码时涉及中文字符需要以UTF-8编码

### 6.2 Java编码规范
- 类名使用大驼峰命名法（PascalCase）
- 方法名和变量名使用小驼峰命名法（camelCase）
- 常量使用全大写，单词间用下划线分隔
- 包名使用小写字母
- 注释使用中文，格式规范

### 6.3 JavaScript/TypeScript编码规范
- 变量名和函数名使用小驼峰命名法
- 常量使用全大写，单词间用下划线分隔
- 文件名使用小写字母，单词间用中划线分隔
- 组件名使用大驼峰命名法

### 6.4 CSS编码规范
- 类名使用小写字母，单词间用中划线分隔
- 使用语义化的类名
- 避免使用内联样式
- 统一使用SCSS预处理器

## 7. 接口规范

### 7.1 RESTful API规范
- **GET**：查询操作
- **POST**：新增操作
- **PUT**：修改操作
- **DELETE**：删除操作

### 7.2 URL命名规范
```
# 管理端接口
/admin/category          # 分类管理
/admin/dish             # 菜品管理
/admin/employee         # 员工管理
/admin/order            # 订单管理

# 用户端接口
/user/category          # 分类查询
/user/dish              # 菜品查询
/user/order             # 订单操作
/user/shoppingCart      # 购物车操作
```

### 7.3 响应格式规范
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    // 具体数据
  }
}
```

### 7.4 分页响应格式
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 100,
    "records": [
      // 数据列表
    ]
  }
}
```

## 8. 版本控制规范

### 8.1 分支命名规范
- **主分支**：`main` 或 `master`
- **开发分支**：`develop`
- **功能分支**：`feature/功能名称`
- **修复分支**：`hotfix/问题描述`

### 8.2 提交信息规范
```
type(scope): subject

body

footer
```

类型说明：
- `feat`：新功能
- `fix`：修复bug
- `docs`：文档更新
- `style`：代码格式修改
- `refactor`：重构代码
- `test`：测试相关
- `chore`：构建过程或辅助工具的变动

### 8.3 代码审查规范
- 所有代码必须经过Code Review
- 功能分支合并到主分支前必须测试通过
- 保持提交历史清晰，避免无意义的提交

## 9. 环境配置规范

### 9.1 开发环境
- **Java**：JDK 8+
- **Node.js**：14+
- **MySQL**：5.5+
- **Redis**：任意版本
- **IDE**：IntelliJ IDEA / VSCode

### 9.2 部署环境
- **服务器端口**：8072
- **数据库端口**：3306
- **Redis端口**：6379
- **文件上传**：阿里云OSS

## 10. 安全规范

### 10.1 认证授权
- 使用JWT进行用户认证
- 管理端和用户端使用不同的密钥
- Token有效期设置为2小时

### 10.2 数据安全
- 密码使用MD5加密存储
- 敏感数据传输使用HTTPS
- SQL注入防护使用MyBatis参数化查询

### 10.3 接口安全
- 所有接口都需要登录认证（除登录接口外）
- 使用拦截器进行权限校验
- 敏感操作记录日志

---

**注意事项**：
1. 新增功能时严格按照本规范执行，确保与现有代码风格保持一致
2. 涉及中文字符的代码必须使用UTF-8编码
3. 所有接口都需要添加Swagger文档注解
4. 数据库操作必须考虑事务一致性
5. 前端组件要考虑复用性和可维护性

本规范文档将随项目发展持续更新，请开发团队严格遵守。
